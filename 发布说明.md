# 📦 发布说明

## 如何创建新版本

GitHub Actions 会在推送 tag 时自动构建并发布 Windows 可执行文件。

### 方法一：使用命令行

```bash
# 1. 确保所有修改已提交
git add .
git commit -m "你的提交信息"
git push origin main

# 2. 创建并推送 tag（触发自动构建）
git tag v1.0.1
git push origin v1.0.1
```

### 方法二：使用 GitHub 网页

1. 访问仓库页面
2. 点击右侧的 "Releases"
3. 点击 "Draft a new release"
4. 填写信息：
   - **Tag version**: v1.0.1 (必须以 v 开头)
   - **Release title**: 对标账号管理软件 v1.0.1
   - **Description**: 版本更新说明
5. 点击 "Publish release"

## 版本号规范

使用语义化版本号：`v主版本号.次版本号.修订号`

- **主版本号**：重大功能变更或不兼容的 API 修改
- **次版本号**：向下兼容的功能新增
- **修订号**：向下兼容的问题修正

示例：
- `v1.0.0` - 首次正式发布
- `v1.0.1` - 修复 bug
- `v1.1.0` - 添加新功能
- `v2.0.0` - 重大更新

## 自动构建流程

当推送 tag 时，GitHub Actions 会：

1. ✅ 检出代码
2. ✅ 安装 Python 3.10 和依赖
3. ✅ 使用 PyInstaller 打包为单文件 exe
4. ✅ 创建 ZIP 压缩包
5. ✅ 上传到 GitHub Releases

构建完成后，用户可以在 Releases 页面下载 `对标账号管理软件-windows.zip`。

## 已修复的问题

### v1.0.1 修复内容

✅ **修复打包错误** - 解决 "No module named 'ui'" 错误
- 更新 PyInstaller 的 hiddenimports 配置
- 添加所有子模块（ui.widgets, ui.dialogs, core.*, utils.*）
- 添加必要的第三方库依赖

**技术细节**:
- PyInstaller 需要显式声明所有动态导入的模块
- 之前的配置只包含顶层模块 `ui`、`core`、`utils`
- 现在包含完整的子模块列表：
  - `ui.widgets.account_list_widget`
  - `ui.widgets.article_list_widget`
  - `ui.dialogs.add_account_dialog`
  - `ui.dialogs.add_article_dialog`
  - `core.database`, `core.account_manager`, `core.article_manager`, `core.export_manager`
  - `utils.logger`, `utils.config`, `utils.validators`
  - 第三方库：`openpyxl.styles`, `dateutil.parser` 等

## 本地测试打包

如需本地测试打包流程：

```bash
# 1. 安装 PyInstaller
pip install pyinstaller

# 2. 运行打包脚本（Windows）
build.bat

# 或手动执行
pyinstaller --clean build.spec
```

打包成功后，可执行文件位于 `dist/对标账号管理软件.exe`。

## 注意事项

1. **Tag 必须以 `v` 开头**，如 `v1.0.0`，否则不会触发构建
2. **不要删除已发布的 tag**，会导致版本历史混乱
3. **每次发布前先在本地测试**，确保功能正常
4. **构建需要 5-10 分钟**，可在 Actions 标签页查看进度

## 下载和使用

发布后，用户可以：

1. 访问项目的 Releases 页面
2. 下载 `对标账号管理软件-windows.zip`
3. 解压到任意目录
4. 双击 `对标账号管理软件.exe` 运行

首次运行时，程序会自动创建：
- `data/` - 数据库文件
- `logs/` - 日志文件

## 常见问题

### Q: 构建失败怎么办？

A: 检查 Actions 页面的构建日志，常见问题：
- 依赖安装失败 → 检查 requirements.txt
- 打包失败 → 检查 hiddenimports 配置
- 上传失败 → 检查 GitHub token 权限

### Q: 如何添加新的模块到打包？

A: 编辑两个文件：
1. `.github/workflows/release.yml` - 在 `hidden_imports` 列表中添加
2. `build.spec` - 在 `hidden_imports` 列表中添加

### Q: 打包后的 exe 太大？

A: 可以优化：
- 移除不必要的依赖
- 使用 `excludes` 排除不需要的模块
- 使用 `--strip` 参数（已启用 UPX 压缩）

## 版本历史

- **v1.0.1** (2025-10-08) - 修复 PyInstaller 打包配置
- **v1.0.0** (2025-10-07) - 首次发布
