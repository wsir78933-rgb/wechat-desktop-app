name: Release Build

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      env:
        PIP_DISABLE_PIP_VERSION_CHECK: 1
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip --disable-pip-version-check
        pip install --disable-pip-version-check -r requirements.txt
        pip install --disable-pip-version-check pyinstaller

    - name: Build Windows executable
      run: |
        pyinstaller --clean build.spec

    - name: Create ZIP archive
      run: |
        Compress-Archive -Path dist/å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶.exe -DestinationPath å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶-windows.zip

    - name: Install Inno Setup
      run: |
        choco install innosetup -y

    - name: Build Windows Installer
      run: |
        & "C:\Program Files (x86)\Inno Setup 6\ISCC.exe" installer.iss

    - name: Upload to Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶-windows.zip
          output/installer/å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶-setup-*.exe
        body: |
          ## å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶ - Windowsç‰ˆæœ¬

          ### ğŸ“¦ ä¸‹è½½æ–¹å¼

          **æ¨èï¼šå®‰è£…ç¨‹åºç‰ˆæœ¬ï¼ˆsetup.exeï¼‰**
          - âœ… è‡ªåŠ¨åˆ›å»ºå¼€å§‹èœå•å¿«æ·æ–¹å¼
          - âœ… è‡ªåŠ¨åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ï¼ˆå¯é€‰ï¼‰
          - âœ… å®Œæ•´çš„å¸è½½åŠŸèƒ½
          - âœ… ä¸“ä¸šçš„å®‰è£…å‘å¯¼ç•Œé¢

          ä¸‹è½½ `å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶-setup-*.exe`ï¼ŒåŒå‡»è¿è¡Œå®‰è£…å‘å¯¼

          **ä¾¿æºç‰ˆæœ¬ï¼ˆzipï¼‰**
          - ä¸‹è½½ `å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶-windows.zip`
          - è§£å‹åˆ°ä»»æ„ç›®å½•
          - åŒå‡» `å¯¹æ ‡è´¦å·ç®¡ç†è½¯ä»¶.exe` è¿è¡Œ

          ### åŠŸèƒ½ç‰¹æ€§
          - è´¦å·ç®¡ç†ï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
          - æ–‡ç« ç®¡ç†ï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ã€æœç´¢ï¼‰
          - æ•°æ®å¯¼å…¥ï¼ˆExcelã€JSONï¼‰
          - æ•°æ®å¯¼å‡ºï¼ˆExcelã€JSONã€Markdownï¼‰
          - å·¦å³åˆ†æ ç•Œé¢
          - Material Designé£æ ¼

          ### æŠ€æœ¯æ ˆ
          - Python 3.10
          - PyQt5
          - SQLite3
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
