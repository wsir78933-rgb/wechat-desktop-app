# é¡¹ç›®ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•æ ‘

```
å…¬ä¼—å·æ¡Œé¢åº”ç”¨/
â”œâ”€â”€ package.json                    # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ dosc/                           # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ éœ€æ±‚æ–‡æ¡£.md
â”‚   â”œâ”€â”€ æŠ€æœ¯æ–‡æ¡£.md
â”‚   â”œâ”€â”€ IPCé€šä¿¡æ¶æ„æ–‡æ¡£.md          âœ… æ–°å¢ï¼šIPCæ¶æ„è¯¦ç»†è¯´æ˜
â”‚   â”œâ”€â”€ IPC-README.md               âœ… æ–°å¢ï¼šå¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â””â”€â”€ é¡¹ç›®ç»“æ„è¯´æ˜.md             âœ… æ–°å¢ï¼šæœ¬æ–‡æ¡£
â”‚
â””â”€â”€ src/                            # æºä»£ç ç›®å½•
    â”œâ”€â”€ types/                      âœ… æ–°å¢ï¼šå…±äº«ç±»å‹å®šä¹‰
    â”‚   â””â”€â”€ ipc.ts                  # IPCé€šä¿¡ç±»å‹å®šä¹‰
    â”‚
    â”œâ”€â”€ main/                       # ä¸»è¿›ç¨‹ä»£ç 
    â”‚   â”œâ”€â”€ index.ts                âœ… å·²æ›´æ–°ï¼šä¸»è¿›ç¨‹å…¥å£ + IPCæ³¨å†Œ
    â”‚   â”‚
    â”‚   â”œâ”€â”€ ipc/                    âœ… æ–°å¢ï¼šIPCå¤„ç†å™¨æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ index.ts            # ç»Ÿä¸€æ³¨å†Œ/æ¸…ç†IPCå¤„ç†å™¨
    â”‚   â”‚   â”œâ”€â”€ article.ts          # æ–‡ç« ç›¸å…³IPCå¤„ç†å™¨
    â”‚   â”‚   â”œâ”€â”€ tag.ts              # æ ‡ç­¾ç›¸å…³IPCå¤„ç†å™¨
    â”‚   â”‚   â”œâ”€â”€ search.ts           # æœç´¢ç›¸å…³IPCå¤„ç†å™¨
    â”‚   â”‚   â””â”€â”€ system.ts           # ç³»ç»Ÿç›¸å…³IPCå¤„ç†å™¨
    â”‚   â”‚
    â”‚   â”œâ”€â”€ database/               # æ•°æ®åº“æ¨¡å—ï¼ˆå·²æœ‰ï¼‰
    â”‚   â”‚   â”œâ”€â”€ index.ts
    â”‚   â”‚   â”œâ”€â”€ db.ts
    â”‚   â”‚   â”œâ”€â”€ articleService.ts
    â”‚   â”‚   â”œâ”€â”€ tagService.ts
    â”‚   â”‚   â””â”€â”€ searchService.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ scrapers/               # çˆ¬è™«æ¨¡å—ï¼ˆå·²æœ‰ï¼‰
    â”‚   â”‚   â”œâ”€â”€ index.ts
    â”‚   â”‚   â”œâ”€â”€ types.ts
    â”‚   â”‚   â”œâ”€â”€ wechat.ts
    â”‚   â”‚   â”œâ”€â”€ example.ts
    â”‚   â”‚   â””â”€â”€ test.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ windows/                # çª—å£ç®¡ç†ï¼ˆå·²æœ‰ï¼‰
    â”‚       â”œâ”€â”€ index.ts
    â”‚       â”œâ”€â”€ types.ts
    â”‚       â”œâ”€â”€ mainWindow.ts
    â”‚       â”œâ”€â”€ floatWindow.ts
    â”‚       â””â”€â”€ windowManager.ts
    â”‚
    â”œâ”€â”€ preload/                    # Preloadè„šæœ¬
    â”‚   â””â”€â”€ index.ts                âœ… å·²æ›´æ–°ï¼šå®‰å…¨APIæ¡¥æ¥
    â”‚
    â””â”€â”€ renderer/                   # æ¸²æŸ“è¿›ç¨‹ä»£ç 
        â””â”€â”€ src/
            â”œâ”€â”€ main.tsx            # æ¸²æŸ“è¿›ç¨‹å…¥å£
            â”œâ”€â”€ App.tsx             # Reactæ ¹ç»„ä»¶
            â”œâ”€â”€ vite-env.d.ts       # Viteç±»å‹å£°æ˜
            â”‚
            â””â”€â”€ examples/           âœ… æ–°å¢ï¼šä½¿ç”¨ç¤ºä¾‹
                â””â”€â”€ ipc-usage-example.tsx  # IPCè°ƒç”¨ç¤ºä¾‹ç»„ä»¶
```

---

## æ¨¡å—è¯´æ˜

### 1. å…±äº«ç±»å‹ (`src/types/`)

**æ–‡ä»¶ï¼š** `ipc.ts`

**ä½œç”¨ï¼š** å®šä¹‰ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹å…±äº«çš„ç±»å‹

**åŒ…å«å†…å®¹ï¼š**
- æ•°æ®ç±»å‹ï¼š`Article`, `Tag`, `SearchParams`, `SearchResult`, etc.
- IPCé€šé“å¸¸é‡ï¼š`IPC_CHANNELS`
- APIæ¥å£å®šä¹‰ï¼š`IpcApi`
- Windowå…¨å±€æ¥å£æ‰©å±•

**ç‰¹ç‚¹ï¼š**
- âœ… ç±»å‹å®‰å…¨ï¼šæ‰€æœ‰IPCé€šä¿¡éƒ½æœ‰å®Œæ•´ç±»å‹
- âœ… å•ä¸€çœŸç›¸æºï¼šé¿å…ç±»å‹é‡å¤å®šä¹‰
- âœ… è‡ªåŠ¨è¡¥å…¨ï¼šIDEæ™ºèƒ½æç¤º

---

### 2. ä¸»è¿›ç¨‹ (`src/main/`)

#### 2.1 ä¸»å…¥å£ (`index.ts`)

**æ›´æ–°å†…å®¹ï¼š**
- âœ… å¯¼å…¥IPCæ³¨å†Œå™¨
- âœ… åº”ç”¨å¯åŠ¨æ—¶æ³¨å†Œæ‰€æœ‰IPCå¤„ç†å™¨
- âœ… åº”ç”¨é€€å‡ºå‰æ¸…ç†IPCå¤„ç†å™¨
- âœ… å¢å¼ºçš„çª—å£é…ç½®ï¼ˆå®‰å…¨æ€§ã€æ€§èƒ½ï¼‰
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†

**å…³é”®ä»£ç ï¼š**
```typescript
import { registerAllIpcHandlers, unregisterAllIpcHandlers } from './ipc';

app.whenReady().then(() => {
  registerAllIpcHandlers();  // æ³¨å†ŒIPC
  createWindow();
});

app.on('before-quit', () => {
  unregisterAllIpcHandlers();  // æ¸…ç†IPC
});
```

#### 2.2 IPCå¤„ç†å™¨ (`src/main/ipc/`)

**æ–°å¢æ¨¡å—ï¼Œå¤„ç†æ‰€æœ‰IPCé€šä¿¡**

| æ–‡ä»¶ | åŠŸèƒ½ | IPCé€šé“æ•° |
|-----|------|----------|
| `index.ts` | ç»Ÿä¸€æ³¨å†Œå™¨ | - |
| `article.ts` | æ–‡ç« CRUDã€é‡‡é›†ã€å¯¼å‡º | 7 |
| `tag.ts` | æ ‡ç­¾ç®¡ç†ã€å…³è”æ“ä½œ | 6 |
| `search.ts` | æœç´¢ã€ç»Ÿè®¡ | 3 |
| `system.ts` | ç³»ç»Ÿè·¯å¾„ã€å¤–éƒ¨é“¾æ¥ | 2 |

**ç‰¹æ€§ï¼š**
- âœ… æ¨¡å—åŒ–ï¼šæŒ‰åŠŸèƒ½æ‹†åˆ†å¤„ç†å™¨
- âœ… ç±»å‹å®‰å…¨ï¼šå®Œæ•´çš„TypeScriptç±»å‹
- âœ… é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€çš„é”™è¯¯æ•è·å’Œæ—¥å¿—
- âœ… è¾“å…¥éªŒè¯ï¼šå‚æ•°æ ¡éªŒå’Œå®‰å…¨æ£€æŸ¥

#### 2.3 æ•°æ®åº“æ¨¡å— (`src/main/database/`)

**çŠ¶æ€ï¼š** å·²æœ‰æ¡†æ¶ï¼Œå¾…ä¸IPCé›†æˆ

**é›†æˆæ–¹å¼ï¼š**
```typescript
// IPCå¤„ç†å™¨è°ƒç”¨æ•°æ®åº“æœåŠ¡
import { ArticleDatabase } from '../database/article';

ipcMain.handle('article:getAll', async (_event, limit, offset) => {
  const db = new ArticleDatabase();
  return await db.getAll(limit, offset);
});
```

#### 2.4 çˆ¬è™«æ¨¡å— (`src/main/scrapers/`)

**çŠ¶æ€ï¼š** å·²æœ‰æ¡†æ¶ï¼Œå¾…ä¸IPCé›†æˆ

**é›†æˆæ–¹å¼ï¼š**
```typescript
// IPCå¤„ç†å™¨è°ƒç”¨çˆ¬è™«æœåŠ¡
import { WechatScraper } from '../scrapers/wechat';

ipcMain.handle('article:scrape', async (_event, params) => {
  const scraper = new WechatScraper();
  return await scraper.scrape(params);
});
```

---

### 3. Preloadè„šæœ¬ (`src/preload/`)

**æ–‡ä»¶ï¼š** `index.ts`

**æ›´æ–°å†…å®¹ï¼š**
- âœ… å®Œæ•´çš„IPC APIå®ç°
- âœ… ç™½åå•éªŒè¯æœºåˆ¶
- âœ… ç±»å‹å®‰å…¨åŒ…è£…
- âœ… å¼€å‘ç¯å¢ƒæ—¥å¿—

**å®‰å…¨ç‰¹æ€§ï¼š**
```typescript
// 1. ç™½åå•éªŒè¯
const ALLOWED_CHANNELS = Object.values(IPC_CHANNELS);
function isValidChannel(channel: string): boolean {
  return ALLOWED_CHANNELS.includes(channel);
}

// 2. å®‰å…¨è°ƒç”¨åŒ…è£…
function safeInvoke<T>(channel: string, ...args: any[]): Promise<T> {
  if (!isValidChannel(channel)) {
    return Promise.reject(new Error('æœªæˆæƒçš„IPCé€šé“'));
  }
  return ipcRenderer.invoke(channel, ...args);
}

// 3. contextBridgeæš´éœ²
contextBridge.exposeInMainWorld('api', {
  getAllArticles: (limit, offset) =>
    safeInvoke(IPC_CHANNELS.ARTICLE_GET_ALL, limit, offset),
  // ... æ›´å¤šAPI
});
```

**æš´éœ²çš„APIæ•°é‡ï¼š** 16ä¸ªæ–¹æ³•

---

### 4. æ¸²æŸ“è¿›ç¨‹ (`src/renderer/`)

#### 4.1 ä½¿ç”¨ç¤ºä¾‹ (`src/renderer/src/examples/`)

**æ–‡ä»¶ï¼š** `ipc-usage-example.tsx`

**æ–°å¢ç»„ä»¶ï¼š**
1. `ArticleListExample` - æ–‡ç« åˆ—è¡¨å±•ç¤ºå’Œåˆ é™¤
2. `ArticleScrapeExample` - æ–‡ç« é‡‡é›†å’Œè¿›åº¦ç›‘å¬
3. `SearchExample` - æ–‡ç« æœç´¢å’Œå»ºè®®
4. `TagManagementExample` - æ ‡ç­¾ç®¡ç†

**ç‰¹ç‚¹ï¼š**
- âœ… å®Œæ•´çš„CRUDç¤ºä¾‹
- âœ… é”™è¯¯å¤„ç†ç¤ºä¾‹
- âœ… åŠ è½½çŠ¶æ€ç®¡ç†
- âœ… React Hooksä½¿ç”¨
- âœ… TypeScriptç±»å‹å®‰å…¨

**ä½¿ç”¨æ–¹å¼ï¼š**
```typescript
// åœ¨App.tsxä¸­å¯¼å…¥
import { ArticleListExample } from './examples/ipc-usage-example';

export default function App() {
  return <ArticleListExample />;
}
```

---

## IPCé€šä¿¡æµç¨‹

```
æ¸²æŸ“è¿›ç¨‹ç»„ä»¶
    â”‚
    â”‚ 1. è°ƒç”¨ window.api.xxx()
    â–¼
Preloadè„šæœ¬
    â”‚
    â”‚ 2. ç™½åå•éªŒè¯
    â”‚ 3. safeInvoke()
    â–¼
IPCé€šé“ (å®‰å…¨éš”ç¦»)
    â”‚
    â”‚ 4. ipcMain.handle()
    â–¼
IPCå¤„ç†å™¨
    â”‚
    â”‚ 5. å‚æ•°éªŒè¯
    â”‚ 6. ä¸šåŠ¡é€»è¾‘
    â–¼
æ•°æ®åº“/çˆ¬è™«æœåŠ¡
    â”‚
    â”‚ 7. æ•°æ®æ“ä½œ
    â–¼
è¿”å›ç»“æœ
    â”‚
    â”‚ 8. é”™è¯¯å¤„ç†
    â”‚ 9. è¿”å›æ¸²æŸ“è¿›ç¨‹
    â–¼
ç»„ä»¶æ›´æ–°UI
```

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **Electron 28.x** - æ¡Œé¢åº”ç”¨æ¡†æ¶
- **React 18.x** - UIæ¡†æ¶
- **TypeScript 5.x** - ç±»å‹å®‰å…¨
- **Vite 5.x** - æ„å»ºå·¥å…·

### ä¸»è¿›ç¨‹
- **better-sqlite3** - SQLiteæ•°æ®åº“
- **cheerio** - HTMLè§£æï¼ˆçˆ¬è™«ï¼‰
- **axios** - HTTPè¯·æ±‚

### æ¸²æŸ“è¿›ç¨‹
- **Zustand** - çŠ¶æ€ç®¡ç†
- **TailwindCSS** - æ ·å¼æ¡†æ¶

---

## æ–‡ä»¶ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶ï¼ˆæœ¬æ¬¡åˆ›å»ºï¼‰

```
src/types/ipc.ts                          âœ… 151è¡Œ
src/main/ipc/article.ts                   âœ… 205è¡Œ
src/main/ipc/tag.ts                       âœ… 156è¡Œ
src/main/ipc/search.ts                    âœ… 174è¡Œ
src/main/ipc/system.ts                    âœ…  89è¡Œ
src/main/ipc/index.ts                     âœ…  62è¡Œ
src/preload/index.ts                      âœ… 172è¡Œï¼ˆå·²æ›´æ–°ï¼‰
src/main/index.ts                         âœ… 151è¡Œï¼ˆå·²æ›´æ–°ï¼‰
src/renderer/src/examples/ipc-usage-example.tsx  âœ… 412è¡Œ
dosc/IPCé€šä¿¡æ¶æ„æ–‡æ¡£.md                   âœ… 1200è¡Œ
dosc/IPC-README.md                        âœ…  350è¡Œ
dosc/é¡¹ç›®ç»“æ„è¯´æ˜.md                      âœ… æœ¬æ–‡æ¡£
```

**æ€»è®¡ï¼š** 3,272+ è¡Œä»£ç å’Œæ–‡æ¡£

---

## å¼€å‘çŠ¶æ€

### âœ… å·²å®Œæˆ

1. **IPCé€šä¿¡æ¶æ„**
   - âœ… ç±»å‹å®šä¹‰å®Œæ•´
   - âœ… Preloadå®‰å…¨æ¡¥æ¥
   - âœ… IPCå¤„ç†å™¨æ¨¡å—åŒ–
   - âœ… ä¸»è¿›ç¨‹é›†æˆ

2. **å®‰å…¨æœºåˆ¶**
   - âœ… ä¸Šä¸‹æ–‡éš”ç¦»
   - âœ… æ²™ç®±æ¨¡å¼
   - âœ… é€šé“ç™½åå•
   - âœ… è¾“å…¥éªŒè¯

3. **å¼€å‘ä½“éªŒ**
   - âœ… TypeScriptç±»å‹å®‰å…¨
   - âœ… å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
   - âœ… è¯¦ç»†çš„æ¶æ„æ–‡æ¡£
   - âœ… å¼€å‘æ—¥å¿—ç³»ç»Ÿ

### ğŸš§ å¾…å®Œæˆ

1. **æ•°æ®åº“é›†æˆ**
   - IPCå¤„ç†å™¨è¿æ¥çœŸå®æ•°æ®åº“
   - å®ç°å®Œæ•´çš„CRUDæ“ä½œ
   - æ·»åŠ äº‹åŠ¡æ”¯æŒ

2. **çˆ¬è™«é›†æˆ**
   - IPCå¤„ç†å™¨è¿æ¥çˆ¬è™«å¼•æ“
   - å®ç°è¿›åº¦å›è°ƒ
   - æ·»åŠ é”™è¯¯é‡è¯•

3. **å¯¼å‡ºæœåŠ¡**
   - Markdownå¯¼å‡º
   - HTMLå¯¼å‡º
   - PDFå¯¼å‡ºï¼ˆéœ€è¦é¢å¤–ä¾èµ–ï¼‰

4. **æµ‹è¯•è¦†ç›–**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - E2Eæµ‹è¯•

---

## å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹æ¶æ„æ–‡æ¡£

```bash
# è¯¦ç»†æ¶æ„è¯´æ˜
cat dosc/IPCé€šä¿¡æ¶æ„æ–‡æ¡£.md

# å¿«é€Ÿå¼€å§‹æŒ‡å—
cat dosc/IPC-README.md
```

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 3. æµ‹è¯•IPCé€šä¿¡

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼š

```javascript
// æµ‹è¯•æ–‡ç« API
await window.api.getAllArticles(10, 0);

// æµ‹è¯•æ ‡ç­¾API
await window.api.getAllTags();

// æµ‹è¯•æœç´¢API
await window.api.searchArticles({ keyword: 'test' });
```

### 4. æŸ¥çœ‹ç¤ºä¾‹ç»„ä»¶

```typescript
// src/renderer/src/App.tsx
import { ArticleListExample } from './examples/ipc-usage-example';

export default function App() {
  return <ArticleListExample />;
}
```

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“é›†æˆ
1. å®ç°ArticleDatabaseç±»
2. å®ç°TagDatabaseç±»
3. å®ç°SearchServiceç±»
4. IPCå¤„ç†å™¨è¿æ¥æ•°æ®åº“

### ç¬¬äºŒé˜¶æ®µï¼šçˆ¬è™«é›†æˆ
1. å®Œå–„WechatScraperç±»
2. å®ç°é‡‡é›†è¿›åº¦å›è°ƒ
3. IPCå¤„ç†å™¨è¿æ¥çˆ¬è™«

### ç¬¬ä¸‰é˜¶æ®µï¼šåŠŸèƒ½å®Œå–„
1. å®ç°å¯¼å‡ºæœåŠ¡
2. æ·»åŠ é”™è¯¯å¤„ç†
3. æ€§èƒ½ä¼˜åŒ–

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•ä¸æ–‡æ¡£
1. ç¼–å†™å•å…ƒæµ‹è¯•
2. ç¼–å†™é›†æˆæµ‹è¯•
3. å®Œå–„ç”¨æˆ·æ–‡æ¡£

---

## ç›¸å…³æ–‡æ¡£

- **éœ€æ±‚æ–‡æ¡£ï¼š** `dosc/éœ€æ±‚æ–‡æ¡£.md`
- **æŠ€æœ¯æ–‡æ¡£ï¼š** `dosc/æŠ€æœ¯æ–‡æ¡£.md`
- **IPCæ¶æ„ï¼š** `dosc/IPCé€šä¿¡æ¶æ„æ–‡æ¡£.md` â­
- **å¿«é€Ÿå¼€å§‹ï¼š** `dosc/IPC-README.md` â­
- **é¡¹ç›®ç»“æ„ï¼š** `dosc/é¡¹ç›®ç»“æ„è¯´æ˜.md` ï¼ˆæœ¬æ–‡æ¡£ï¼‰

---

## è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°çš„IPCåŠŸèƒ½

1. åœ¨ `src/types/ipc.ts` å®šä¹‰ç±»å‹
2. åœ¨ `src/main/ipc/` åˆ›å»ºå¤„ç†å™¨
3. åœ¨ `src/main/ipc/index.ts` æ³¨å†Œ
4. åœ¨ `src/preload/index.ts` æš´éœ²API
5. åœ¨ `src/renderer/src/examples/` æ·»åŠ ç¤ºä¾‹

### ç¼–ç è§„èŒƒ

- âœ… ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
- âœ… éµå¾ªESLintè§„åˆ™
- âœ… æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- âœ… ç¼–å†™å•å…ƒæµ‹è¯•

---

**æœ€åæ›´æ–°ï¼š** 2025-10-06
**ç‰ˆæœ¬ï¼š** 1.0.0
**ä½œè€…ï¼š** IPCé€šä¿¡æ¶æ„å›¢é˜Ÿ
