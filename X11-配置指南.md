# WSL2 + X11 + Electron å®Œæ•´é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°
æœ¬æŒ‡å—å¸®åŠ©ä½ åœ¨WSL2ç¯å¢ƒä¸­è¿è¡ŒElectronæ¡Œé¢åº”ç”¨,éœ€è¦é…ç½®X11å›¾å½¢ç•Œé¢è½¬å‘ã€‚

---

## âš ï¸ é‡è¦å‰æ

**ç¡®ä¿ä»¥ä¸‹äº‹é¡¹å®Œæˆ:**
- âœ… WSL2å·²å®‰è£…å¹¶æ­£å¸¸è¿è¡Œ
- âœ… Windowsç³»ç»Ÿç‰ˆæœ¬: Windows 10 2004+ æˆ– Windows 11
- âœ… é¡¹ç›®ä¾èµ–å·²å®‰è£…: `npm install`

---

## ğŸ“¦ æ­¥éª¤1: å®‰è£…Windows XæœåŠ¡å™¨ (VcXsrv)

### æ–¹å¼A: ä½¿ç”¨æµè§ˆå™¨ä¸‹è½½

1. è®¿é—®: https://sourceforge.net/projects/vcxsrv/
2. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„å®‰è£…ç¨‹åº
3. è¿è¡Œå®‰è£…,ä¸€è·¯ç‚¹å‡» "Next"

### æ–¹å¼B: ä½¿ç”¨WindowsåŒ…ç®¡ç†å™¨ (æ¨è)

åœ¨Windows PowerShellæˆ–CMDä¸­è¿è¡Œ:

```powershell
winget install --id marha.VcXsrv
```

---

## ğŸš€ æ­¥éª¤2: å¯åŠ¨å¹¶é…ç½®VcXsrv

**åœ¨Windowsä¸­å¯åŠ¨ XLaunch** (å¼€å§‹èœå•æœç´¢ "XLaunch"):

### é…ç½®é¡µé¢1: Display settings
- é€‰æ‹©: **Multiple windows**
- Display number: **0**
- ç‚¹å‡» "Next"

### é…ç½®é¡µé¢2: Client startup
- é€‰æ‹©: **Start no client**
- ç‚¹å‡» "Next"

### é…ç½®é¡µé¢3: Extra settings âš ï¸ å…³é”®è®¾ç½®
- âœ… **å¿…é¡»å‹¾é€‰**: "Disable access control"
- âœ… **å»ºè®®å‹¾é€‰**: "Native opengl"
- ç‚¹å‡» "Next"

### é…ç½®é¡µé¢4: Finish
- (å¯é€‰) ç‚¹å‡» "Save configuration" ä¿å­˜é…ç½®,ä¸‹æ¬¡ç›´æ¥åŠ è½½
- ç‚¹å‡» "Finish" å¯åŠ¨

**éªŒè¯**: ç³»ç»Ÿæ‰˜ç›˜åº”è¯¥å‡ºç°ä¸€ä¸ª **Xå›¾æ ‡**,è¡¨ç¤ºVcXsrvæ­£åœ¨è¿è¡Œã€‚

---

## ğŸ”¥ æ­¥éª¤3: é…ç½®Windowsé˜²ç«å¢™

VcXsrvéœ€è¦å…è®¸WSL2è¿æ¥,å¿…é¡»é…ç½®é˜²ç«å¢™:

### æ–¹å¼A: è‡ªåŠ¨æ·»åŠ è§„åˆ™ (æ¨è)

åœ¨Windows PowerShell (ç®¡ç†å‘˜) ä¸­è¿è¡Œ:

```powershell
# å…è®¸VcXsrvæ¥å—WSL2è¿æ¥
New-NetFirewallRule -DisplayName "VcXsrv" -Direction Inbound -Program "C:\Program Files\VcXsrv\vcxsrv.exe" -Action Allow
```

### æ–¹å¼B: æ‰‹åŠ¨æ·»åŠ è§„åˆ™

1. æ‰“å¼€ "Windows Defender é˜²ç«å¢™"
2. ç‚¹å‡» "é«˜çº§è®¾ç½®"
3. é€‰æ‹© "å…¥ç«™è§„åˆ™" -> "æ–°å»ºè§„åˆ™"
4. è§„åˆ™ç±»å‹: ç¨‹åº
5. ç¨‹åºè·¯å¾„: `C:\Program Files\VcXsrv\vcxsrv.exe`
6. æ“ä½œ: å…è®¸è¿æ¥
7. é…ç½®æ–‡ä»¶: å…¨é€‰
8. åç§°: VcXsrv

---

## ğŸ§ æ­¥éª¤4: é…ç½®WSL2ç¯å¢ƒå˜é‡

X11ç¯å¢ƒå˜é‡å·²è‡ªåŠ¨æ·»åŠ åˆ° `~/.bashrc`ã€‚

**æ‰‹åŠ¨éªŒè¯é…ç½®**:

```bash
tail -10 ~/.bashrc
```

åº”è¯¥çœ‹åˆ°:

```bash
# === WSL2 X11 é…ç½® ===
export DISPLAY=$(ip route show | grep default | awk '{print $3}'):0
export LIBGL_ALWAYS_INDIRECT=1
export ELECTRON_ENABLE_LOGGING=1
export ELECTRON_DISABLE_GPU=1
```

---

## ğŸ§ª æ­¥éª¤5: æµ‹è¯•X11è¿æ¥

åœ¨WSL2ç»ˆç«¯ä¸­è¿è¡Œ:

```bash
# åŠ è½½ç¯å¢ƒå˜é‡
source ~/.bashrc

# æµ‹è¯•X11è¿æ¥
xdpyinfo | head -5
```

**æˆåŠŸè¾“å‡ºç¤ºä¾‹**:

```
name of display:    192.168.x.x:0
version number:    11.0
vendor string:    ...
```

**å¦‚æœå¤±è´¥**,æ£€æŸ¥:
- âœ… VcXsrvæ­£åœ¨è¿è¡Œ (ç³»ç»Ÿæ‰˜ç›˜æœ‰Xå›¾æ ‡)
- âœ… é˜²ç«å¢™è§„åˆ™å·²æ·»åŠ 
- âœ… VcXsrvé…ç½®ä¸­å‹¾é€‰äº† "Disable access control"

---

## ğŸ¯ æ­¥éª¤6: å¯åŠ¨Electronåº”ç”¨

### ä½¿ç”¨å¯åŠ¨è„šæœ¬ (æ¨è)

```bash
cd /home/wcp/é¡¹ç›®é›†åˆ/å…¬ä¼—å·æ¡Œé¢åº”ç”¨
./start-with-x11.sh
```

å¯åŠ¨è„šæœ¬ä¼š:
1. è‡ªåŠ¨é…ç½®ç¯å¢ƒå˜é‡
2. æµ‹è¯•X11è¿æ¥
3. æ¸…ç†æ—§è¿›ç¨‹
4. å¯åŠ¨åº”ç”¨

### æ‰‹åŠ¨å¯åŠ¨

```bash
cd /home/wcp/é¡¹ç›®é›†åˆ/å…¬ä¼—å·æ¡Œé¢åº”ç”¨

# è®¾ç½®ç¯å¢ƒå˜é‡
export DISPLAY=$(ip route show | grep default | awk '{print $3}'):0
export LIBGL_ALWAYS_INDIRECT=1
export ELECTRON_DISABLE_GPU=1

# å¯åŠ¨åº”ç”¨
npm run dev
```

---

## âœ… æ­¥éª¤7: éªŒè¯åº”ç”¨æ­£å¸¸è¿è¡Œ

åº”ç”¨å¯åŠ¨å,åº”è¯¥çœ‹åˆ°:

1. **WSL2ç»ˆç«¯è¾“å‡º**:
   ```
   dev server running for the electron renderer process at:
   âœ  Local:   http://localhost:5173/
   start electron app...
   [Main] åº”ç”¨å‡†å¤‡å®Œæˆ
   [Main] âœ… ä¸»çª—å£åˆ›å»ºå®Œæˆ
   ```

2. **Windowsæ¡Œé¢**: å‡ºç°Electronåº”ç”¨çª—å£

3. **ç³»ç»Ÿæ‰˜ç›˜**: VcXsrvå›¾æ ‡ä»åœ¨è¿è¡Œ

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: "unable to open display"

**åŸå› **: X11æœåŠ¡å™¨æœªè¿è¡Œæˆ–è¿æ¥å¤±è´¥

**è§£å†³**:
1. ç¡®è®¤VcXsrvæ­£åœ¨è¿è¡Œ
2. é‡æ–°å¯åŠ¨VcXsrv,ç¡®ä¿å‹¾é€‰ "Disable access control"
3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
4. éªŒè¯DISPLAYå˜é‡: `echo $DISPLAY` (åº”æ˜¾ç¤ºç±»ä¼¼ `192.168.x.x:0`)

### é—®é¢˜2: "ReferenceError: File is not defined"

**åŸå› **: æŸäº›Nodeæ¨¡å—ä¸Electronç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³**:
```bash
# ç¡®ä¿ç¯å¢ƒå˜é‡å·²è®¾ç½®
export ELECTRON_DISABLE_GPU=1
npm run dev
```

### é—®é¢˜3: çª—å£æ˜¾ç¤ºä½†æ— å“åº”

**åŸå› **: GPUåŠ é€Ÿé—®é¢˜

**è§£å†³**:
```bash
export LIBGL_ALWAYS_INDIRECT=1
export ELECTRON_DISABLE_GPU=1
npm run dev
```

### é—®é¢˜4: VcXsrvå¯åŠ¨åç«‹å³å…³é—­

**åŸå› **: ç«¯å£å†²çªæˆ–é…ç½®é”™è¯¯

**è§£å†³**:
1. å…³é—­æ‰€æœ‰VcXsrvè¿›ç¨‹: ä»»åŠ¡ç®¡ç†å™¨ -> ç»“æŸ vcxsrv.exe
2. é‡æ–°è¿è¡ŒXLaunché…ç½®
3. ç¡®ä¿Display numberè®¾ç½®ä¸º 0

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### è‡ªåŠ¨å¯åŠ¨VcXsrv

åˆ›å»ºWindowså¿«æ·æ–¹å¼,å‚æ•°:

```
"C:\Program Files\VcXsrv\vcxsrv.exe" :0 -multiwindow -clipboard -wgl -ac
```

å°†å¿«æ·æ–¹å¼æ”¾å…¥å¯åŠ¨æ–‡ä»¶å¤¹: `Win+R` -> `shell:startup`

### ä¿å­˜VcXsrvé…ç½®

åœ¨XLaunchæœ€åä¸€æ­¥ç‚¹å‡» "Save configuration",ä¿å­˜ä¸º `config.xlaunch`,ä¸‹æ¬¡åŒå‡»ç›´æ¥å¯åŠ¨ã€‚

### æµ‹è¯•X11åº”ç”¨

å®‰è£…ç®€å•çš„X11åº”ç”¨æµ‹è¯•:

```bash
sudo apt install x11-apps
xeyes  # åº”è¯¥å¼¹å‡ºä¸€ä¸ªçœ¼ç›è·Ÿéšé¼ æ ‡çš„çª—å£
```

---

## ğŸ“š ç›¸å…³èµ„æº

- VcXsrvå®˜ç½‘: https://sourceforge.net/projects/vcxsrv/
- WSL2æ–‡æ¡£: https://docs.microsoft.com/zh-cn/windows/wsl/
- Electronæ–‡æ¡£: https://www.electronjs.org/docs

---

## ğŸ‰ å®Œæˆ

é…ç½®å®Œæˆå,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨:

```bash
cd /home/wcp/é¡¹ç›®é›†åˆ/å…¬ä¼—å·æ¡Œé¢åº”ç”¨
./start-with-x11.sh
```

æˆ–è€…æ·»åŠ åˆ° `.bashrc` çš„åˆ«å:

```bash
alias start-app='cd /home/wcp/é¡¹ç›®é›†åˆ/å…¬ä¼—å·æ¡Œé¢åº”ç”¨ && ./start-with-x11.sh'
```

ç„¶åç›´æ¥è¿è¡Œ `start-app` å³å¯! ğŸš€
